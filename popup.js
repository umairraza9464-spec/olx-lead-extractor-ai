document.addEventListener('DOMContentLoaded',()=>{loadStats();loadConfig();document.getElementById('saveBtn').onclick=saveConfig;document.getElementById('extractBtn').onclick=extractPage;document.getElementById('testBtn').onclick=testLlama;document.getElementById('clearBtn').onclick=clearHistory});function loadStats(){chrome.storage.local.get(['stats'],(data)=>{const stats=data.stats||{total:0,today:0,lastDate:''};document.getElementById('totalCount').textContent=stats.total;const today=new Date().toLocaleDateString('en-IN');document.getElementById('todayCount').textContent=stats.lastDate===today?stats.today:0})}function loadConfig(){chrome.storage.sync.get(['groqApiKey','sheetId','webhookUrl','autoExtract'],(data)=>{document.getElementById('groqApiKey').value=data.groqApiKey||'';document.getElementById('sheetId').value=data.sheetId||'';document.getElementById('webhookUrl').value=data.webhookUrl||'';document.getElementById('autoExtract').checked=data.autoExtract!==false})}function saveConfig(){const groqApiKey=document.getElementById('groqApiKey').value.trim();const sheetId=document.getElementById('sheetId').value.trim();const webhookUrl=document.getElementById('webhookUrl').value.trim();const autoExtract=document.getElementById('autoExtract').checked;if(!groqApiKey||!sheetId||!webhookUrl){showStatus('âŒ Fill all fields!','error');return}chrome.storage.sync.set({groqApiKey,sheetId,webhookUrl,autoExtract},()=>{showStatus('âœ… Saved!','success')})}function extractPage(){showStatus('ðŸ”„ Extracting...','info');chrome.tabs.query({active:true,currentWindow:true},(tabs)=>{if(!tabs[0].url.includes('olx.in')){showStatus('âŒ Open OLX page!','error');return}chrome.tabs.sendMessage(tabs[0].id,{action:'extract'},(response)=>{if(chrome.runtime.lastError){showStatus('âŒ Refresh page!','error');return}showStatus(response?.message||'âœ… Done!',response?.success?'success':'error');loadStats()})})}async function testLlama(){const apiKey=document.getElementById('groqApiKey').value.trim();if(!apiKey){showStatus('âŒ Enter API key!','error');return}showStatus('ðŸ”„ Testing AI...','info');try{const res=await fetch('https://api.groq.com/openai/v1/chat/completions',{method:'POST',headers:{'Authorization':`Bearer ${apiKey}`,'Content-Type':'application/json'},body:JSON.stringify({model:'llama-3.3-70b-versatile',messages:[{role:'user',content:'Say hello'}],max_tokens:10})});if(res.ok){showStatus('âœ… Llama AI working!','success')}else{showStatus('âŒ Invalid API key!','error')}}catch(err){showStatus('âŒ Connection failed!','error')}}function clearHistory(){if(confirm('Clear all extraction history?')){chrome.storage.local.set({extractedNumbers:[],stats:{total:0,today:0,lastDate:''}},()=>{showStatus('âœ… History cleared!','success');loadStats()})}}function showStatus(msg,type){const status=document.getElementById('status');status.textContent=msg;status.className=`show ${type}`;setTimeout(()=>status.className='',3000)}
